---   
# plugin pipeline
  - name: Install plugin pipeline
    jenkins_plugin:
      name: pipeline-plugin
      url_username: admin
      url_password: admin
      url: http://localhost:8080

# restart jenkins
  - name: Restart Jenkins
    service: name=jenkins state=restarted

  - name: Wait for Jenkins to restart
    wait_for:
      host=localhost
      port=8080
      delay=20
      timeout=300

  - name: copy templates/config.xml
    copy:
      src: templates/config.xml
      dest: ./

  # - name: login to Jenkins
  #   shell: java -jar "/opt/jenkins-cli.jar" -s http://localhost:8080

  - name: create Jenkins job from configuration
    shell: java -jar "/opt/jenkins-cli.jar" -s http://localhost:8080 create-job Project_Pipeline < ./config.xml


  # - name: Restart Jenkins if required
  #   service:
  #     name: jenkins
  #     state: restarted
  #   when: jenkins_restart_required

  # - name: jenkns login
  #     url_username: admin
  #     url_password: admin
  #     url: http://localhost:8080